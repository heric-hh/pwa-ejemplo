<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mi Primera PWA</title>
    <!-- Vincular el manifest -->
    <link rel="manifest" href="manifest.json" />
    <!-- Color de la barra de navegacion en móviles -->
    <meta name="theme-color" content="#317EFB" />
  </head>
  <body>
    <h1>Bienvenido a mi PWA</h1>
    <p>Se puede instalar en tu dispositivo móvil</p>
    <button onclick="alert('Hola desde la PWA')">Click aqui</button>

    <ul>
      <li><a href="index.html">Inicio</a></li>
      <li><a href="login.html">Iniciar Sesion</a></li>
    </ul>

    <!-- Botón de instalación de PWA -->
    <div id="installContainer" style="margin-top: 20px; display: none">
      <button id="installButton">Instalar PWA</button>
      <p id="installMessage"></p>
    </div>

    <!-- Registrar el Service Worker -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("sw.js")
            .then((reg) => console.log("Service Worker registrado", reg))
            .catch((err) =>
              console.warn("Error al registrar el Service Worker", err)
            );
        });
      }

      // Variables para manejar el evento de instalación
      let deferredPrompt;

      // Detectar si el navegador permite instalar la PWA
      window.addEventListener("beforeinstallprompt", (e) => {
        // Evita que Chrome 67 y versiones anteriores muestren automáticamente el banner
        e.preventDefault();
        // Guarda el evento para que se pueda activar más tarde
        deferredPrompt = e;

        // Muestra el botón de instalación
        const installContainer = document.getElementById("installContainer");
        installContainer.style.display = "block";
      });

      // Función para manejar la instalación cuando se hace clic en el botón
      document.getElementById("installButton").addEventListener("click", () => {
        if (deferredPrompt) {
          // Muestra el prompt de instalación
          deferredPrompt.prompt();

          // Espera a que el usuario responda al prompt
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === "accepted") {
              console.log("Usuario aceptó la instalación de PWA");
              document.getElementById("installMessage").textContent =
                "¡PWA instalada exitosamente!";
            } else {
              console.log("Usuario rechazó la instalación de PWA");
              document.getElementById("installMessage").textContent =
                "Instalación cancelada";
            }
            // Oculta el botón de instalación
            document.getElementById("installContainer").style.display = "none";
            deferredPrompt = null;
          });
        }
      });
    </script>
  </body>
</html>
